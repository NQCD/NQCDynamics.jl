<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Scattering probabilities for TullyModelTwo · NQCDynamics.jl</title><meta name="title" content="Scattering probabilities for TullyModelTwo · NQCDynamics.jl"/><meta property="og:title" content="Scattering probabilities for TullyModelTwo · NQCDynamics.jl"/><meta property="twitter:title" content="Scattering probabilities for TullyModelTwo · NQCDynamics.jl"/><meta name="description" content="Documentation for NQCDynamics.jl."/><meta property="og:description" content="Documentation for NQCDynamics.jl."/><meta property="twitter:description" content="Documentation for NQCDynamics.jl."/><meta property="og:url" content="https://nqcd.github.io/NQCDynamics.jl/stable/examples/tully_scattering/"/><meta property="twitter:url" content="https://nqcd.github.io/NQCDynamics.jl/stable/examples/tully_scattering/"/><link rel="canonical" href="https://nqcd.github.io/NQCDynamics.jl/stable/examples/tully_scattering/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="NQCDynamics.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">NQCDynamics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../getting_started/">Getting started</a></li><li><a class="tocitem" href="../../atoms/">Atoms</a></li><li><a class="tocitem" href="../../ensemble_simulations/">Ensemble simulations</a></li><li><a class="tocitem" href="../../saving_loading/">Saving and loading</a></li><li><span class="tocitem">NQCModels.jl</span><ul><li><a class="tocitem" href="../../NQCModels/overview/">NQCModels.jl</a></li><li><a class="tocitem" href="../../NQCModels/analyticmodels/">Analytic model library</a></li><li><a class="tocitem" href="../../NQCModels/ase/">ASE interface</a></li><li><a class="tocitem" href="../../NQCModels/neuralnetworkmodels/">Neural network models</a></li><li><a class="tocitem" href="../../NQCModels/frictionmodels/">Electronic friction models</a></li></ul></li><li><span class="tocitem">NQCDistributions.jl</span><ul><li><a class="tocitem" href="../../NQCDistributions/overview/">NQCDistributions.jl</a></li></ul></li><li><span class="tocitem">Initial conditions</span><ul><li><a class="tocitem" href="../../initialconditions/ebk/">Semiclassical EBK quantisation</a></li><li><a class="tocitem" href="../../initialconditions/hamiltonian/">Thermal Hamiltonian Monte Carlo</a></li><li><a class="tocitem" href="../../initialconditions/langevin/">Thermal Langevin dynamics</a></li><li><a class="tocitem" href="../../initialconditions/metropolishastings/">Thermal Metropolis-Hastings Monte Carlo</a></li></ul></li><li><span class="tocitem">Dynamics simulations</span><ul><li><a class="tocitem" href="../../dynamicssimulations/dynamicssimulations/">Introduction</a></li><li><a class="tocitem" href="../../dynamicssimulations/dynamicsmethods/classical/">Classical molecular dynamics</a></li><li><a class="tocitem" href="../../dynamicssimulations/dynamicsmethods/ehrenfest/">Ehrenfest molecular dynamics</a></li><li><a class="tocitem" href="../../dynamicssimulations/dynamicsmethods/fssh/">Fewest-switches surface hopping (FSSH)</a></li><li><a class="tocitem" href="../../dynamicssimulations/dynamicsmethods/langevin/">Classical Langevin dynamics</a></li><li><a class="tocitem" href="../../dynamicssimulations/dynamicsmethods/mdef/">Molecular dynamics with electronic friction (MDEF)</a></li><li><a class="tocitem" href="../../dynamicssimulations/dynamicsmethods/nrpmd/">Nonadiabatic ring polymer molecular dynamics (NRPMD)</a></li><li><a class="tocitem" href="../../dynamicssimulations/dynamicsmethods/rpmd/">Ring polymer molecular dynamics (RPMD)</a></li><li><a class="tocitem" href="../../dynamicssimulations/dynamicsmethods/rpsh/">Ring polymer surface hopping (RPSH)</a></li></ul></li><li><span class="tocitem">Outputs and Analysis</span><ul><li><a class="tocitem" href="../../output_and_analysis/intro/">Simulations outputs and analysis functions</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../reactive_scattering/">Reactive scattering from a metal surface</a></li><li><a class="tocitem" href="../spinboson/">Ohmic spin-boson nonequilibrium population dynamics</a></li><li><a class="tocitem" href="../threestatemorse/">Time-dependent populations with the ThreeStateMorse model</a></li><li class="is-active"><a class="tocitem" href>Scattering probabilities for TullyModelTwo</a></li></ul></li><li><a class="tocitem" href="../../integration_algorithms/">Integration algorithms</a></li><li><span class="tocitem">Developer documentation</span><ul><li><a class="tocitem" href="../../devdocs/diffeq/">DifferentialEquations.jl integration</a></li><li><a class="tocitem" href="../../devdocs/models/">Implementing a new model</a></li><li><a class="tocitem" href="../../devdocs/new_methods/">Contributing a new method</a></li></ul></li><li><span class="tocitem">API</span><ul><li><input class="collapse-toggle" id="menuitem-14-1" type="checkbox"/><label class="tocitem" for="menuitem-14-1"><span class="docs-label">NQCBase</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/NQCBase/nqcbase/">NQCBase</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14-2" type="checkbox"/><label class="tocitem" for="menuitem-14-2"><span class="docs-label">NQCModels</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/NQCModels/adiabaticmodels/">AdiabaticModels</a></li><li><a class="tocitem" href="../../api/NQCModels/cubeldfamodel/">CubeLDFAModel</a></li><li><a class="tocitem" href="../../api/NQCModels/diabaticmodels/">DiabaticModels</a></li><li><a class="tocitem" href="../../api/NQCModels/frictionmodels/">FrictionModels</a></li><li><a class="tocitem" href="../../api/NQCModels/nninterfaces/">NNInterfaces</a></li><li><a class="tocitem" href="../../api/NQCModels/nonadiabaticmodels/">NQCModels</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14-3" type="checkbox"/><label class="tocitem" for="menuitem-14-3"><span class="docs-label">NQCDistributions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/NQCDistributions/nqcdistributions/">NQCDistributions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14-4" type="checkbox"/><label class="tocitem" for="menuitem-14-4"><span class="docs-label">NQCDynamics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/NQCDynamics/analysis/">Analysis</a></li><li><a class="tocitem" href="../../api/NQCDynamics/calculators/">Calculators</a></li><li><a class="tocitem" href="../../api/NQCDynamics/dynamicsmethods/">DynamicsMethods</a></li><li><a class="tocitem" href="../../api/NQCDynamics/dynamicsoutputs/">DynamicsOutputs</a></li><li><a class="tocitem" href="../../api/NQCDynamics/dynamicsutils/">DynamicsUtils</a></li><li><a class="tocitem" href="../../api/NQCDynamics/ensembles/">Ensembles</a></li><li><a class="tocitem" href="../../api/NQCDynamics/estimators/">Estimators</a></li><li><a class="tocitem" href="../../api/NQCDynamics/initialconditions/">InitialConditions</a></li><li><a class="tocitem" href="../../api/NQCDynamics/nonadiabaticmoleculardynamics/">NQCDynamics</a></li><li><a class="tocitem" href="../../api/NQCDynamics/numericutils/">Numerical utilities</a></li><li><a class="tocitem" href="../../api/NQCDynamics/ringpolymers/">RingPolymers</a></li><li><a class="tocitem" href="../../api/NQCDynamics/structure/">Structure</a></li><li><a class="tocitem" href="../../api/NQCDynamics/timecorrelationfunctions/">TimeCorrelationFunctions</a></li></ul></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Scattering probabilities for TullyModelTwo</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Scattering probabilities for TullyModelTwo</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/NQCD/NQCDynamics.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/NQCD/NQCDynamics.jl/blob/main/docs/src/examples/tully_scattering.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="examples-tully-model-two"><a class="docs-heading-anchor" href="#examples-tully-model-two">Scattering probabilities for TullyModelTwo</a><a id="examples-tully-model-two-1"></a><a class="docs-heading-anchor-permalink" href="#examples-tully-model-two" title="Permalink"></a></h1><p>In this section we aim to reproduce the results of Fig. 5 from [<a href="../../references/#Tully1990">1</a>]. This figure presents the scattering outcomes when a particle interacts with Tully&#39;s model 2 with an increasing magnitude of incident kinetic energy.</p><p>To reproduce this figure, first, let&#39;s set up our system parameters:</p><pre><code class="language-julia hljs">using NQCDynamics

sim = Simulation{FSSH}(Atoms(2000), TullyModelTwo())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Simulation{FSSH{Float64}}:
  Atoms{Float64}([:X], [0], [2000.0])
  TullyModelTwo{Float64, Float64, Float64, Float64, Float64}
  a: Float64 0.1
  b: Float64 0.28
  c: Float64 0.015
  d: Float64 0.06
  e: Float64 0.05
</code></pre><p>!!! note Atomic units</p><pre><code class="nohighlight hljs">Recall that all of are units are atomic by default, this mass of 2000 is similar to
that of a hydrogen atom.</code></pre><p>Each data point in the figure is obtained from an ensemble average of trajectories. We can use our <a href="../../api/NQCDynamics/ensembles/#Ensembles"><code>Ensembles</code></a> setup to run a set of trajectories for every single momentum value. Firstly, we can prepare the parts that will be the same for every ensemble:</p><pre><code class="language-julia hljs">using ComponentArrays: ComponentVector

output = OutputStateResolvedScattering1D(sim, :adiabatic)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">OutputStateResolvedScattering1D{Simulation{FSSH{Float64}, NQCDynamics.Calculators.DiabaticCalculator{Float64, TullyModelTwo{Float64, Float64, Float64, Float64, Float64}, 2, 4}, Float64, Unitful.Quantity{Int64, 𝚯, Unitful.FreeUnits{(K,), 𝚯, nothing}}, InfiniteCell}}(Simulation{FSSH{Float64}}:
  Atoms{Float64}([:X], [0], [2000.0])
  TullyModelTwo{Float64, Float64, Float64, Float64, Float64}
  a: Float64 0.1
  b: Float64 0.28
  c: Float64 0.015
  d: Float64 0.06
  e: Float64 0.05
, :adiabatic)</code></pre><p>Here, we are using the <a href="../../api/NQCDynamics/dynamicsoutputs/#NQCDynamics.DynamicsOutputs.OutputStateResolvedScattering1D"><code>OutputStateResolvedScattering1D</code></a> along with the <a href="../../api/NQCDynamics/ensembles/#NQCDynamics.Ensembles.MeanReduction"><code>MeanReduction</code></a> which will give us the average scattering outcome from the entire ensemble. Each trajectory outputs the scattering outcome along with its final adiabatic state, and the reduction computes the average over all trajectories.</p><p>Next, we can choose how many trajectories we want to perform for each ensemble, and choose the range of momentum values:</p><pre><code class="language-julia hljs">trajectories = 500
momenta = 9:2:50</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">9:2:49</code></pre><div class="admonition is-info"><header class="admonition-header">Range notation</header><div class="admonition-body"><p>Here we uses <a href="https://docs.julialang.org/en/v1/base/math/#Base.::">Julia&#39;s range operator</a> to generate a set of values from 9 to 50 with a spacing of 2: 9, 11, 13, ..., 49. The final value of 50 is not included since a step size of 2 starting from 9 allows us to include only odd numbers.</p></div></div><p>Since each ensemble requires different initial conditions, we will specify the trajectory timespan and the distribution inside the loop. Before the loop begins, we will create an empty list to store the results, and append to this list after every iteration. The distribution we create produces initial conditions where each trajectory has momentum <code>k</code> and starts at a position of <code>-5</code>. </p><pre><code class="language-julia hljs">result = []
for k in momenta # Iterate through each momentum value
    v = k / sim.atoms.masses[1] # Starting velocity
    r = -5 # Starting position
    tspan = (0, 2abs(r)/v)
    distribution = DynamicalDistribution(v, -5, size(sim)) * PureState(1, Adiabatic())

    out = run_dynamics(sim, tspan, distribution;
        saveat=tspan[end], trajectories, output, reduction=MeanReduction()
    )

    push!(result, out[:OutputStateResolvedScattering1D])
end

result</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">21-element Vector{Any}:
 ComponentVector{Float64}(reflection = [0.008, 0.0], transmission = [0.992, 0.0])
 ComponentVector{Float64}(reflection = [0.014, 0.002], transmission = [0.974, 0.01])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.868, 0.132])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.85, 0.15])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.916, 0.084])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.966, 0.034])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.934, 0.066])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.832, 0.168])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.676, 0.324])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.476, 0.524])
 ⋮
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.34, 0.66])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.38, 0.62])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.51, 0.49])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.636, 0.364])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.782, 0.218])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.898, 0.102])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.936, 0.064])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [0.98, 0.02])
 ComponentVector{Float64}(reflection = [0.0, 0.0], transmission = [1.0, 0.0])</code></pre><div class="admonition is-success"><header class="admonition-header">Adaptive timespan</header><div class="admonition-body"><p>Since the trajectories with larger momentum will exit the scattering region sooner, we scale the timespan to save computational time. Using <code>tspan = (0, 2abs(r)/v)</code> allows enough time such that a particle will be able to travel a total distance of <code>2r</code> at a constant velocity of v. This is sufficient to ensure the particle has left the interaction region. Alternatively, we could <a href="../../devdocs/diffeq/#devdocs-callbacks">define a callback to terminate the simulation early</a>.</p></div></div><p>Now we can plot our simulation results. We format this plot to match Fig. 3 from [<a href="../../references/#Shakib2017">18</a>] which also reproduces Fig. 5 from [<a href="../../references/#Tully1990">1</a>]. We manage to reproduce the FSSH results quite accurately by visual comparison, though a larger number of trajectories would lead to better convergence. Since all of the examples run during the documentation build, we use a minimal number of trajectories to optimise the build time.</p><pre><code class="language-julia hljs">using Plots

plot(
    xlabel=&quot;Incidence momentum / a.u.&quot;,
    ylabel=&quot;Scattering probability&quot;
)

r1 = [r.reflection[1] for r in result]
t1 = [r.transmission[1] for r in result]
t2 = [r.transmission[2] for r in result]

scatter!(momenta, r1; label=&quot;R1&quot;, color=:red)
scatter!(momenta, t1; label=&quot;T1&quot;, color=:green)
scatter!(momenta, t2; label=&quot;T2&quot;, color=:blue)</code></pre><img src="071c7e56.svg" alt="Example block output"/><p>As in [<a href="../../references/#Shakib2017">18</a>], R1, T1, T2 refer to reflection on state 1, transmission on state 1 and transmission on state 2 respectively. For this model, surface hopping is successful in closely approximating the exact quantum result, especially at higher momentum values. Refer to [<a href="../../references/#Tully1990">1</a>] and [<a href="../../references/#Shakib2017">18</a>] for a detailed discussion of the results.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../threestatemorse/">« Time-dependent populations with the ThreeStateMorse model</a><a class="docs-footer-nextpage" href="../../integration_algorithms/">Integration algorithms »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Friday 16 August 2024 14:25">Friday 16 August 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
