<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Classical Langevin dynamics · NQCDynamics.jl</title><meta name="title" content="Classical Langevin dynamics · NQCDynamics.jl"/><meta property="og:title" content="Classical Langevin dynamics · NQCDynamics.jl"/><meta property="twitter:title" content="Classical Langevin dynamics · NQCDynamics.jl"/><meta name="description" content="Documentation for NQCDynamics.jl."/><meta property="og:description" content="Documentation for NQCDynamics.jl."/><meta property="twitter:description" content="Documentation for NQCDynamics.jl."/><meta property="og:url" content="https://nqcd.github.io/NQCDynamics.jl/stable/dynamicssimulations/dynamicsmethods/langevin/"/><meta property="twitter:url" content="https://nqcd.github.io/NQCDynamics.jl/stable/dynamicssimulations/dynamicsmethods/langevin/"/><link rel="canonical" href="https://nqcd.github.io/NQCDynamics.jl/stable/dynamicssimulations/dynamicsmethods/langevin/"/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="NQCDynamics.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">NQCDynamics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Introduction</a></li><li><a class="tocitem" href="../../../getting_started/">Getting started</a></li><li><a class="tocitem" href="../../../atoms/">Atoms</a></li><li><a class="tocitem" href="../../../ensemble_simulations/">Ensemble simulations</a></li><li><a class="tocitem" href="../../../saving_loading/">Saving and loading</a></li><li><span class="tocitem">NQCModels.jl</span><ul><li><a class="tocitem" href="../../../NQCModels/overview/">NQCModels.jl</a></li><li><a class="tocitem" href="../../../NQCModels/analyticmodels/">Analytic model library</a></li><li><a class="tocitem" href="../../../NQCModels/ase/">ASE interface</a></li><li><a class="tocitem" href="../../../NQCModels/neuralnetworkmodels/">Neural network models</a></li><li><a class="tocitem" href="../../../NQCModels/frictionmodels/">Electronic friction models</a></li></ul></li><li><span class="tocitem">NQCDistributions.jl</span><ul><li><a class="tocitem" href="../../../NQCDistributions/overview/">NQCDistributions.jl</a></li></ul></li><li><span class="tocitem">Initial conditions</span><ul><li><a class="tocitem" href="../../../initialconditions/ebk/">Semiclassical EBK quantisation</a></li><li><a class="tocitem" href="../../../initialconditions/hamiltonian/">Thermal Hamiltonian Monte Carlo</a></li><li><a class="tocitem" href="../../../initialconditions/langevin/">Thermal Langevin dynamics</a></li><li><a class="tocitem" href="../../../initialconditions/metropolishastings/">Thermal Metropolis-Hastings Monte Carlo</a></li></ul></li><li><span class="tocitem">Dynamics simulations</span><ul><li><a class="tocitem" href="../../dynamicssimulations/">Introduction</a></li><li><a class="tocitem" href="../classical/">Classical molecular dynamics</a></li><li><a class="tocitem" href="../ehrenfest/">Ehrenfest molecular dynamics</a></li><li><a class="tocitem" href="../fssh/">Fewest-switches surface hopping (FSSH)</a></li><li class="is-active"><a class="tocitem" href>Classical Langevin dynamics</a><ul class="internal"><li><a class="tocitem" href="#Example"><span>Example</span></a></li></ul></li><li><a class="tocitem" href="../mdef/">Molecular dynamics with electronic friction (MDEF)</a></li><li><a class="tocitem" href="../nrpmd/">Nonadiabatic ring polymer molecular dynamics (NRPMD)</a></li><li><a class="tocitem" href="../rpmd/">Ring polymer molecular dynamics (RPMD)</a></li><li><a class="tocitem" href="../rpsh/">Ring polymer surface hopping (RPSH)</a></li></ul></li><li><span class="tocitem">Outputs and Analysis</span><ul><li><a class="tocitem" href="../../../output_and_analysis/intro/">Simulations outputs and analysis functions</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../../examples/reactive_scattering/">Reactive scattering from a metal surface</a></li><li><a class="tocitem" href="../../../examples/spinboson/">Ohmic spin-boson nonequilibrium population dynamics</a></li><li><a class="tocitem" href="../../../examples/threestatemorse/">Time-dependent populations with the ThreeStateMorse model</a></li><li><a class="tocitem" href="../../../examples/tully_scattering/">Scattering probabilities for TullyModelTwo</a></li></ul></li><li><a class="tocitem" href="../../../integration_algorithms/">Integration algorithms</a></li><li><span class="tocitem">Developer documentation</span><ul><li><a class="tocitem" href="../../../devdocs/diffeq/">DifferentialEquations.jl integration</a></li><li><a class="tocitem" href="../../../devdocs/models/">Implementing a new model</a></li><li><a class="tocitem" href="../../../devdocs/new_methods/">Contributing a new method</a></li></ul></li><li><span class="tocitem">API</span><ul><li><input class="collapse-toggle" id="menuitem-14-1" type="checkbox"/><label class="tocitem" for="menuitem-14-1"><span class="docs-label">NQCBase</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/NQCBase/nqcbase/">NQCBase</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14-2" type="checkbox"/><label class="tocitem" for="menuitem-14-2"><span class="docs-label">NQCModels</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/NQCModels/adiabaticmodels/">AdiabaticModels</a></li><li><a class="tocitem" href="../../../api/NQCModels/cubeldfamodel/">CubeLDFAModel</a></li><li><a class="tocitem" href="../../../api/NQCModels/diabaticmodels/">DiabaticModels</a></li><li><a class="tocitem" href="../../../api/NQCModels/frictionmodels/">FrictionModels</a></li><li><a class="tocitem" href="../../../api/NQCModels/nninterfaces/">NNInterfaces</a></li><li><a class="tocitem" href="../../../api/NQCModels/nonadiabaticmodels/">NQCModels</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14-3" type="checkbox"/><label class="tocitem" for="menuitem-14-3"><span class="docs-label">NQCDistributions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/NQCDistributions/nqcdistributions/">NQCDistributions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14-4" type="checkbox"/><label class="tocitem" for="menuitem-14-4"><span class="docs-label">NQCDynamics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/NQCDynamics/analysis/">Analysis</a></li><li><a class="tocitem" href="../../../api/NQCDynamics/calculators/">Calculators</a></li><li><a class="tocitem" href="../../../api/NQCDynamics/dynamicsmethods/">DynamicsMethods</a></li><li><a class="tocitem" href="../../../api/NQCDynamics/dynamicsoutputs/">DynamicsOutputs</a></li><li><a class="tocitem" href="../../../api/NQCDynamics/dynamicsutils/">DynamicsUtils</a></li><li><a class="tocitem" href="../../../api/NQCDynamics/ensembles/">Ensembles</a></li><li><a class="tocitem" href="../../../api/NQCDynamics/estimators/">Estimators</a></li><li><a class="tocitem" href="../../../api/NQCDynamics/initialconditions/">InitialConditions</a></li><li><a class="tocitem" href="../../../api/NQCDynamics/nonadiabaticmoleculardynamics/">NQCDynamics</a></li><li><a class="tocitem" href="../../../api/NQCDynamics/numericutils/">Numerical utilities</a></li><li><a class="tocitem" href="../../../api/NQCDynamics/ringpolymers/">RingPolymers</a></li><li><a class="tocitem" href="../../../api/NQCDynamics/structure/">Structure</a></li><li><a class="tocitem" href="../../../api/NQCDynamics/timecorrelationfunctions/">TimeCorrelationFunctions</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Dynamics simulations</a></li><li class="is-active"><a href>Classical Langevin dynamics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Classical Langevin dynamics</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/NQCD/NQCDynamics.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/NQCD/NQCDynamics.jl/blob/main/docs/src/dynamicssimulations/dynamicsmethods/langevin.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="langevin-dynamics"><a class="docs-heading-anchor" href="#langevin-dynamics">Classical Langevin dynamics</a><a id="langevin-dynamics-1"></a><a class="docs-heading-anchor-permalink" href="#langevin-dynamics" title="Permalink"></a></h1><p>Langevin dynamics can be used to sample the canonical ensemble for a classical system. Langevin dynamics are based on classical equations of motion that are modified by an additional drag force and a random force. The Langevin equation of motion can be written as</p><p class="math-container">\[\mathbf{M}\ddot{\mathbf{R}} = - \nabla_R V(\mathbf{R}) + \mathbf{F}(t) - \gamma \dot{\mathbf{R}}\]</p><p>where <span>$\mathbf{M}$</span> are the masses, <span>$\ddot{\mathbf{R}}$</span> the time-derivative of the positions,  i.e., the velocities, <span>$\nabla_R V(\mathbf{R})$</span> the gradient of the potential and <span>$\mathbf{F}(t)$</span> the random force that is related to the friction coefficient <span>$\gamma$</span> by the second fluctuation-dissipation theorem.</p><p>Equally the above equation can be written in the form of Ito stochastic differential equations [<a href="../../../references/#Leimkuhler2012">7</a>]</p><p class="math-container">\[\begin{aligned}
d\mathbf{R} &amp;= \mathbf{M}^{-1} \mathbf{P} dt\\
d\mathbf{P} &amp;= [-\nabla V(\mathbf{R}) - \gamma \mathbf{P}] dt
+ \sigma \mathbf{M}^{1/2} d\mathbf{W}
\end{aligned}\]</p><p>where <span>$\sigma = \sqrt{2\gamma/\beta}$</span> and <span>$\mathbf{W}$</span> is a vector of <span>$N$</span> independent Wiener processes. As usual, <span>$\mathbf{P}$</span> is the vector of particle momenta and <span>$\mathbf{M}$</span> their diagonal mass matrix.</p><div class="admonition is-info"><header class="admonition-header">Stochastic differential equations</header><div class="admonition-body"><p>There are two mathematical frameworks for handling stochastic differential equations, developed by Ruslan Stratonovich and Kiyosi Ito. To learn about the difference between the two in a physical context refer to [<a href="../../../references/#Risken1989">8</a>].</p></div></div><p>As a stochastic differential equation, these two can be integrated immediately using <code>StochasticDiffEq</code> provided by <code>DifferentialEquations</code>, which offers a variety of stochastic solvers. It is possible to exploit the dynamical structure of the differential equations by splitting the integration steps into parts that can be solved exactly. In this context,  it has been shown that the BAOAB method from [<a href="../../../references/#Leimkuhler2012">7</a>] achieves good accuracy compared to other similar algorithms and this algorithm is used here as the default.</p><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>Using Langevin dynamics we can sample the canonical ensemble for a simple harmonic oscillator and investigate the energy expectation values.</p><p>Firstly we set up our system parameters. Here, we have two atoms in a harmonic potential at a temperature of <code>1e-3</code>. We have arbitrarily chosen the dissipation constant <span>$\gamma = 1$</span>, this can be tuned for optimal sampling in more complex systems. </p><pre><code class="language-julia hljs">using NQCDynamics
using Unitful

atoms = Atoms([:H, :C])
temperature = 1e-3
sim = Simulation{Langevin}(atoms, Harmonic(m=atoms.masses[1]); γ=1, temperature)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Simulation{Langevin{Float64}}:
  Atoms{Float64}([:H, :C], [1, 6], [1837.4715941070515, 21894.713607956142])
  Harmonic{Float64, Float64, Float64}
  m: Float64 1837.4715941070515
  ω: Float64 1.0
  r₀: Float64 0.0
  dofs: Int64 1
</code></pre><div class="admonition is-info"><header class="admonition-header">Atomic units</header><div class="admonition-body"><p>As usual, all quantities are in atomic units by default.</p></div></div><p>Here we can generate a simple starting configuration with zeros for every degree of freedom.</p><pre><code class="language-julia hljs">u = DynamicsVariables(sim, zeros(size(sim)), zeros(size(sim)))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([0.0 0.0], [0.0 0.0])</code></pre><p>Running the dynamics proceeds by providing all the parameters along with any extra keywords. This time we have requested both the positions and velocities to be outputted and have selected a timestep <code>dt</code>. Since the default algorithm is a fixed timestep algorithm an error will be thrown if a timestep is not provided.</p><pre><code class="language-julia hljs">traj = run_dynamics(sim, (0.0, 2000.0), u; output=(OutputPosition, OutputVelocity), dt=0.5)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Dictionaries.Dictionary{Symbol, Any}
           :Time │ [0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5  …  1995.5…
 :OutputPosition │ [[0.0 0.0], [-0.000139940492310738 3.567948941707327e-6], [-…
 :OutputVelocity │ [[0.0 0.0], [-0.0005247768461652675 1.419693745916881e-5], […</code></pre><p>Here, we plot the positions of our two atoms throughout the simulation.</p><pre><code class="language-julia hljs">using Plots
plot(traj, :OutputPosition, label=[&quot;Hydrogen&quot; &quot;Carbon&quot;], legend=true)</code></pre><img src="ead2da45.svg" alt="Example block output"/><p>We next plot the velocities. Notice how the carbon atom with its heavier mass has a smaller magnitude throughout.</p><pre><code class="language-julia hljs">plot(traj, :OutputVelocity, label=[&quot;Hydrogen&quot; &quot;Carbon&quot;], legend=true)</code></pre><img src="7d7e3c95.svg" alt="Example block output"/><p>Using the configurations from the Langevin simulation we can obtain expectation values along the trajectories. This can be done manually, but we provide the <a href="../../../api/NQCDynamics/estimators/#Estimators"><code>Estimators</code></a> module to make this as simple as possible.</p><p>!!! note Estimators</p><pre><code class="nohighlight hljs">[Here](@ref `Estimators`) you can find the available quantities that [`Estimators`](@ref) provides.
To add new quantities, you must implement a new function inside `src/Estimators.jl`.</code></pre><p>Let&#39;s find the expectation for the potential energy during our simulation. This is the potential energy of the final configuration in the simulation:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; Estimators.potential_energy(sim, traj[:OutputPosition][end])</code><code class="nohighlight hljs ansi" style="display:block;">1.0584545629185378e-6</code></pre><p>We could evaluate this for every configuration and average it manually. Fortunately however, we have the <a href="../../../api/NQCDynamics/estimators/#NQCDynamics.Estimators.@estimate-Tuple{Any}"><code>@estimate</code></a> macro that will do this for us:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; Estimators.@estimate potential_energy(sim, traj[:OutputPosition])</code><code class="nohighlight hljs ansi" style="display:block;">0.0008714360199255442</code></pre><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>We can verify this result by comparing to the equipartition theorem which states that each quadratic degree of freedom should contribute <span>$\frac{1}{2}kT$</span> to the total energy. As this is a harmonic system, this gives us the exact classical potential energy expectation as equal to the temperature, since we have two degrees of freedom and we are in atomic units.</p></div></div><p>Similarly, we can evaluate the kinetic energy expectation with:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; Estimators.@estimate kinetic_energy(sim, traj[:OutputVelocity])</code><code class="nohighlight hljs ansi" style="display:block;">0.0009448229952026531</code></pre><p>Again, this takes a similar value since the total energy is evenly split between the kinetic and potential for a classical harmonic system.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../fssh/">« Fewest-switches surface hopping (FSSH)</a><a class="docs-footer-nextpage" href="../mdef/">Molecular dynamics with electronic friction (MDEF) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Friday 16 August 2024 14:25">Friday 16 August 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
