<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Nonadiabatic ring polymer molecular dynamics (NRPMD) · NQCDynamics.jl</title><meta name="title" content="Nonadiabatic ring polymer molecular dynamics (NRPMD) · NQCDynamics.jl"/><meta property="og:title" content="Nonadiabatic ring polymer molecular dynamics (NRPMD) · NQCDynamics.jl"/><meta property="twitter:title" content="Nonadiabatic ring polymer molecular dynamics (NRPMD) · NQCDynamics.jl"/><meta name="description" content="Documentation for NQCDynamics.jl."/><meta property="og:description" content="Documentation for NQCDynamics.jl."/><meta property="twitter:description" content="Documentation for NQCDynamics.jl."/><meta property="og:url" content="https://nqcd.github.io/NQCDynamics.jl/stable/dynamicssimulations/dynamicsmethods/nrpmd.html"/><meta property="twitter:url" content="https://nqcd.github.io/NQCDynamics.jl/stable/dynamicssimulations/dynamicsmethods/nrpmd.html"/><link rel="canonical" href="https://nqcd.github.io/NQCDynamics.jl/stable/dynamicssimulations/dynamicsmethods/nrpmd.html"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../index.html"><img src="../../assets/logo.svg" alt="NQCDynamics.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../index.html">NQCDynamics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../index.html">Introduction</a></li><li><a class="tocitem" href="../../getting_started.html">Getting started</a></li><li><a class="tocitem" href="../../atoms.html">Atoms</a></li><li><a class="tocitem" href="../../ensemble_simulations.html">Ensemble simulations</a></li><li><a class="tocitem" href="../../saving_loading.html">Saving and loading</a></li><li><span class="tocitem">NQCModels.jl</span><ul><li><a class="tocitem" href="../../NQCModels/overview.html">NQCModels.jl</a></li><li><a class="tocitem" href="../../NQCModels/analyticmodels.html">Analytic model library</a></li><li><a class="tocitem" href="../../NQCModels/fullsizemodels.html">Full dimensional model library</a></li><li><a class="tocitem" href="../../NQCModels/frictionmodels.html">Electronic friction models</a></li><li><a class="tocitem" href="../../NQCModels/neuralnetworkmodels.html">MLIP Examples</a></li></ul></li><li><span class="tocitem">NQCDistributions.jl</span><ul><li><a class="tocitem" href="../../NQCDistributions/overview.html">NQCDistributions.jl</a></li></ul></li><li><span class="tocitem">Initial conditions</span><ul><li><a class="tocitem" href="../../initialconditions/ebk.html">Semiclassical EBK quantisation</a></li><li><a class="tocitem" href="../../initialconditions/hamiltonian.html">Thermal Hamiltonian Monte Carlo</a></li><li><a class="tocitem" href="../../initialconditions/langevin.html">Thermal Langevin dynamics</a></li><li><a class="tocitem" href="../../initialconditions/metropolishastings.html">Thermal Metropolis-Hastings Monte Carlo</a></li></ul></li><li><span class="tocitem">Dynamics simulations</span><ul><li><a class="tocitem" href="../dynamicssimulations.html">Introduction</a></li><li><a class="tocitem" href="classical.html">Classical molecular dynamics</a></li><li><a class="tocitem" href="ehrenfest.html">Ehrenfest molecular dynamics</a></li><li><a class="tocitem" href="fssh.html">Fewest-switches surface hopping (FSSH)</a></li><li><a class="tocitem" href="langevin.html">Classical Langevin dynamics</a></li><li><a class="tocitem" href="mdef.html">Molecular dynamics with electronic friction (MDEF)</a></li><li class="is-active"><a class="tocitem" href="nrpmd.html">Nonadiabatic ring polymer molecular dynamics (NRPMD)</a><ul class="internal"><li><a class="tocitem" href="#Theory"><span>Theory</span></a></li><li><a class="tocitem" href="#Implementation-details"><span>Implementation details</span></a></li><li><a class="tocitem" href="#Example"><span>Example</span></a></li></ul></li><li><a class="tocitem" href="rpmd.html">Ring polymer molecular dynamics (RPMD)</a></li><li><a class="tocitem" href="rpsh.html">Ring polymer surface hopping (RPSH)</a></li></ul></li><li><span class="tocitem">Outputs and Analysis</span><ul><li><a class="tocitem" href="../../output_and_analysis/intro.html">Simulations outputs and analysis functions</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/reactive_scattering.html">Reactive scattering from a metal surface</a></li><li><a class="tocitem" href="../../examples/spinboson.html">Ohmic spin-boson nonequilibrium population dynamics</a></li><li><a class="tocitem" href="../../examples/threestatemorse.html">Time-dependent populations with the ThreeStateMorse model</a></li><li><a class="tocitem" href="../../examples/tully_scattering.html">Scattering probabilities for TullyModelTwo</a></li></ul></li><li><a class="tocitem" href="../../integration_algorithms.html">Integration algorithms</a></li><li><span class="tocitem">Developer documentation</span><ul><li><a class="tocitem" href="../../devdocs/diffeq.html">DifferentialEquations.jl integration</a></li><li><a class="tocitem" href="../../devdocs/models.html">Implementing a new model</a></li><li><a class="tocitem" href="../../devdocs/new_methods.html">Contributing a new method</a></li></ul></li><li><span class="tocitem">API</span><ul><li><input class="collapse-toggle" id="menuitem-14-1" type="checkbox"/><label class="tocitem" for="menuitem-14-1"><span class="docs-label">NQCBase</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/NQCBase/nqcbase.html">NQCBase</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14-2" type="checkbox"/><label class="tocitem" for="menuitem-14-2"><span class="docs-label">NQCModels</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/NQCModels/adiabaticmodels.html">AdiabaticModels</a></li><li><a class="tocitem" href="../../api/NQCModels/cubeldfamodel.html">CubeLDFAModel</a></li><li><a class="tocitem" href="../../api/NQCModels/diabaticmodels.html">DiabaticModels</a></li><li><a class="tocitem" href="../../api/NQCModels/frictionmodels.html">FrictionModels</a></li><li><a class="tocitem" href="../../api/NQCModels/mace.html">MACE interface</a></li><li><a class="tocitem" href="../../api/NQCModels/nninterfaces.html">NNInterfaces</a></li><li><a class="tocitem" href="../../api/NQCModels/nonadiabaticmodels.html">NQCModels</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14-3" type="checkbox"/><label class="tocitem" for="menuitem-14-3"><span class="docs-label">NQCDistributions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/NQCDistributions/nqcdistributions.html">NQCDistributions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14-4" type="checkbox"/><label class="tocitem" for="menuitem-14-4"><span class="docs-label">NQCDynamics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/NQCDynamics/analysis.html">Analysis</a></li><li><a class="tocitem" href="../../api/NQCDynamics/calculators.html">Calculators</a></li><li><a class="tocitem" href="../../api/NQCDynamics/dynamicsmethods.html">DynamicsMethods</a></li><li><a class="tocitem" href="../../api/NQCDynamics/dynamicsoutputs.html">DynamicsOutputs</a></li><li><a class="tocitem" href="../../api/NQCDynamics/dynamicsutils.html">DynamicsUtils</a></li><li><a class="tocitem" href="../../api/NQCDynamics/ensembles.html">Ensembles</a></li><li><a class="tocitem" href="../../api/NQCDynamics/estimators.html">Estimators</a></li><li><a class="tocitem" href="../../api/NQCDynamics/initialconditions.html">InitialConditions</a></li><li><a class="tocitem" href="../../api/NQCDynamics/nonadiabaticmoleculardynamics.html">NQCDynamics</a></li><li><a class="tocitem" href="../../api/NQCDynamics/numericutils.html">Numerical utilities</a></li><li><a class="tocitem" href="../../api/NQCDynamics/ringpolymers.html">RingPolymers</a></li><li><a class="tocitem" href="../../api/NQCDynamics/structure.html">Structure</a></li><li><a class="tocitem" href="../../api/NQCDynamics/timecorrelationfunctions.html">TimeCorrelationFunctions</a></li></ul></li></ul></li><li><a class="tocitem" href="../../references.html">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Dynamics simulations</a></li><li class="is-active"><a href="nrpmd.html">Nonadiabatic ring polymer molecular dynamics (NRPMD)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="nrpmd.html">Nonadiabatic ring polymer molecular dynamics (NRPMD)</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/NQCD/NQCDynamics.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/NQCD/NQCDynamics.jl/blob/main/docs/src/dynamicssimulations/dynamicsmethods/nrpmd.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="nrpmd-dynamics"><a class="docs-heading-anchor" href="#nrpmd-dynamics">Nonadiabatic ring polymer molecular dynamics (NRPMD)</a><a id="nrpmd-dynamics-1"></a><a class="docs-heading-anchor-permalink" href="#nrpmd-dynamics" title="Permalink"></a></h1><h2 id="Theory"><a class="docs-heading-anchor" href="#Theory">Theory</a><a id="Theory-1"></a><a class="docs-heading-anchor-permalink" href="#Theory" title="Permalink"></a></h2><p>Nonadiabatic ring polymer molecular dynamics (NRPMD) is a method that uses the ring polymer formalism to include quantum effects in the nuclear dynamics and mapping variables for the electronic degrees of freedom. ([<a href="../../references.html#Richardson2013">9</a>], [<a href="../../references.html#Richardson2017">10</a>], [<a href="../../references.html#Chowdhury2019">11</a>]) This results in a classical dynamics in an extended phasespace of the ring polymer with each bead coupled to a set of classical mapping variables. Originally, this method was proposed as a simple combination of the  Meyer-Miller-Stock-Thoss mapping formalism with RPMD but has since been rigorously derived from nonadiabatic Matsubara dynamics ([<a href="../../references.html#Chowdhury2021">12</a>]).</p><p>The classical Hamiltonian conserved by NRPMD is given by</p><p class="math-container">\[H_N = \sum_{\alpha=1}^N \left[
\frac{P_\alpha^2}{2M} + V_0(R_\alpha)
+ \frac{M}{2\beta_N^2\hbar^2} (R_\alpha - R_{\alpha-1})^2
+ \frac{1}{\hbar} \sum_{nm}V_{nm}(R_\alpha)
([q_\alpha]_n[q_\alpha]_m + [p_\alpha]_n[p_\alpha]_m - \delta_{nm}\hbar)
\right]\]</p><p>which contains <span>$N$</span> replicas with positions <span>$R_\alpha$</span> and momenta <span>$P_\alpha$</span> joined by harmonic springs. <span>$M$</span> is the mass, <span>$\beta_N = \beta / N$</span> is the inverse temperature scaled by the number of beads. <span>$V_0(R_\alpha)$</span> is the state independent potential. <span>$V_{nm}$</span> are the matrix elements of the diabatic potential. The sum runs over all pairs of states. Each replica has a set of mapping variables <span>$[q_\alpha]_n$</span> and <span>$[p_\alpha]_n$</span> that interact only within the set associated with a single replica. The consequence of this is that the electronic dynamics is not contaminated by interbead  coupling.</p><p>The equations of motion obtained from this Hamiltonian are</p><p class="math-container">\[\begin{aligned}
\dot{R}_\alpha &amp;= \frac{P_\alpha}{M}
\\
\dot{P}_\alpha &amp;=
- \frac{M}{\beta_N^2 \hbar^2}(2 R_\alpha - R_{\alpha+1} - R_{\alpha-1})
- \nabla_{R_\alpha} V_0(R_\alpha)
- \frac{1}{2\hbar}\sum_{nm} \nabla_{R_\alpha} V_{nm}(R_\alpha)
([q_\alpha]_n[q_\alpha]_m + [p_\alpha]_n[p_\alpha]_m - \delta_{nm}\hbar)
\\
[\dot{q}_\alpha]_n &amp;=
\frac{1}{\hbar} \sum_m V_{nm}(R_\alpha)[p_\alpha]_m
\\
[\dot{p}_\alpha]_n &amp;=
-\frac{1}{\hbar} \sum_m V_{nm}(R_\alpha)[q_\alpha]_m
\end{aligned}\]</p><h2 id="Implementation-details"><a class="docs-heading-anchor" href="#Implementation-details">Implementation details</a><a id="Implementation-details-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation-details" title="Permalink"></a></h2><h3 id="Solving-the-differential-equations"><a class="docs-heading-anchor" href="#Solving-the-differential-equations">Solving the differential equations</a><a id="Solving-the-differential-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-differential-equations" title="Permalink"></a></h3><p>For mapping variable methods of this type, a symplectic algorithm ([<a href="../../references.html#Church2018">13</a>]) exists. This algorithm has the advantage of long time stability and can be easily combined with the standard algorithms for ring polymer time-evolution. For NRPMD we have implemented this algorithm using the Cayley modified ring polymer propagator ([<a href="../../references.html#Korol2019">14</a>]) and obtain accurate and efficient dynamics. For few beads, similar performance to the OrdinaryDiffEq.jl algorithms is obtained, but as the number of beads increases this algorithm becomes more effective.</p><h3 id="Generating-the-initial-distribution"><a class="docs-heading-anchor" href="#Generating-the-initial-distribution">Generating the initial distribution</a><a id="Generating-the-initial-distribution-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-the-initial-distribution" title="Permalink"></a></h3><p>Currently, we provide this functionality only for nonequilibrium simulations where the nuclear part of the distribution is separable from the electronic part. Typically, the nuclear distribution will be sampled using Langevin dynamics or Monte Carlo sampling and the electronic variables are confined to a single electronic state. This is appropriate for modelling photoexcitation dynamics but is not yet suitable for equilibrium simulations. Equilibrium dynamics would require also sampling a thermal distribution for the mapping variables.</p><h3 id="Form-of-the-Hamiltonian"><a class="docs-heading-anchor" href="#Form-of-the-Hamiltonian">Form of the Hamiltonian</a><a id="Form-of-the-Hamiltonian-1"></a><a class="docs-heading-anchor-permalink" href="#Form-of-the-Hamiltonian" title="Permalink"></a></h3><p>The diabatic models defined in <code>NQCModels.jl</code> are of the appropriate form for this method though they provide the potential as a single matrix, rather than separating the state-dependent and independent parts. It has been suggested that defining the Hamiltonian such that the lowest eigenvalue of the diabatic matrix is zero everywhere leads to improved convergence in the sampling ([<a href="../../references.html#Richardson2013">9</a>]). However, here we have not done this for simplicity when defining the models.</p><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>Using NRPMD we can reproduce the Fig. 3a in the 2019 paper of Chowdhury and Huo ([<a href="../../references.html#Chowdhury2019">11</a>]).</p><p>First we generate a thermal ring polymer distribution in a harmonic potential. A simple way to do this is to use Monte Carlo sampling for the positions and obtain velocities from a Boltzmann distribution.</p><pre><code class="language-julia hljs">using NQCDynamics

atom = Atoms(1)

sim = RingPolymerSimulation(atom, Harmonic(dofs=1), 4; temperature=1/16)

r0 = zeros(size(sim))
steps = 5e3 # Number of Monte Carlo steps
step_size = Dict(:X=&gt;1.0) # Monte Carlo step size for species :X
output = InitialConditions.ThermalMonteCarlo.run_advancedmh_sampling(sim, r0, steps, step_size)
velocities = VelocityBoltzmann(1/16, masses(sim), (1,1))

distribution = DynamicalDistribution(velocities, output, size(sim)) * PureState(1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">NQCDistributions.ProductDistribution{NQCDistributions.RingPolymerWrapper{NQCDistributions.UnivariateArray{2, Distributions.Normal{Float64}}}, NQCDistributions.ConfigurationVector{Vector{Array{Float64, 3}}}, PureState{Diabatic}}(DynamicalDistribution{NQCDistributions.RingPolymerWrapper{NQCDistributions.UnivariateArray{2, Distributions.Normal{Float64}}}, NQCDistributions.ConfigurationVector{Vector{Array{Float64, 3}}}}(NQCDistributions.RingPolymerWrapper{NQCDistributions.UnivariateArray{2, Distributions.Normal{Float64}}}(NQCDistributions.UnivariateArray{2, Distributions.Normal{Float64}}(Distributions.Normal{Float64}[Distributions.Normal{Float64}(μ=0.0, σ=0.25);;]), (1, 1, 4), Int64[]), NQCDistributions.ConfigurationVector{Vector{Array{Float64, 3}}}([[0.0;;; 0.0;;; 0.0;;; 0.0], [0.0;;; 0.0;;; 0.0;;; 0.0], [0.0;;; 0.0;;; 0.0;;; 0.0], [-0.21407429209636983;;; -0.21407429209636983;;; -0.21407429209636983;;; -0.21407429209636983], [-0.21407429209636983;;; -0.21407429209636983;;; -0.21407429209636983;;; -0.21407429209636983], [-0.21407429209636983;;; -0.21407429209636983;;; -0.21407429209636983;;; -0.21407429209636983], [-0.21407429209636983;;; -0.21407429209636983;;; -0.21407429209636983;;; -0.21407429209636983], [-0.0053779611686197715;;; -0.0053779611686197715;;; -0.0053779611686197715;;; -0.0053779611686197715], [-0.0053779611686197715;;; -0.0053779611686197715;;; -0.0053779611686197715;;; -0.0053779611686197715], [0.3465254531854926;;; 0.3465254531854926;;; 0.3465254531854926;;; 0.3465254531854926]  …  [0.4299376688796763;;; 0.39484919016300746;;; 0.3889809751704692;;; -0.37526517458729336], [0.4299376688796763;;; 0.39484919016300746;;; 0.3889809751704692;;; -0.37526517458729336], [0.4299376688796763;;; 0.39484919016300746;;; 0.3889809751704692;;; -0.37526517458729336], [0.242577622927569;;; 0.38115033910887464;;; 0.2016209292183619;;; -0.7362864154373752], [0.242577622927569;;; 0.38115033910887464;;; 0.2016209292183619;;; -0.7362864154373752], [0.242577622927569;;; 0.38115033910887464;;; 0.2016209292183619;;; -0.7362864154373752], [-0.06326507943914245;;; 0.07530763674216322;;; -0.1042217731483495;;; -1.0421291178040866], [-0.06326507943914245;;; 0.07530763674216322;;; -0.1042217731483495;;; -1.0421291178040866], [-0.06326507943914245;;; 0.07530763674216322;;; -0.1042217731483495;;; -1.0421291178040866], [-0.06326507943914245;;; 0.07530763674216322;;; -0.1042217731483495;;; -1.0421291178040866]]), Random.Xoshiro(0xe5629bd0cd4a5b63, 0x5cddeca9674963d4, 0x93c382ed076af394, 0x3b29dea0ddcfb2e3, 0x7cf306d438eb2cf8)), PureState{Diabatic}(1, Diabatic()))</code></pre><div class="admonition is-info"><header class="admonition-header">`size(sim)`</header><div class="admonition-body"><p><code>size(sim)</code> returns the system size as <code>(degrees of freedom, number of atoms, number of beads)</code>.</p></div></div><div class="admonition is-success"><header class="admonition-header">Monte Carlo sampling</header><div class="admonition-body"><p>Further information on Monte Carlo sampling can be found <a href="../../initialconditions/metropolishastings.html#mhmc-sampling">here</a>.</p></div></div><p>We can check the distribution by plotting the phasespace diagram for each of the points in our distribution:</p><pre><code class="language-julia hljs">using Plots

nuclear = distribution.nuclear
flat_position = reduce(vcat, (nuclear.position[i][:] for i in 1:length(nuclear)))
flat_velocity = reduce(vcat, (rand(nuclear.velocity)[:] for _ in 1:length(nuclear)))
scatter(flat_position, flat_velocity)</code></pre><img src="nrpmd-119d3476.svg" alt="Example block output"/><div class="admonition is-info"><header class="admonition-header">`reduce(vcat, ...)`</header><div class="admonition-body"><p>Here we have used <code>reduce</code> in combination with <code>vcat</code> to vertically concatenate all of the information into a single array for plotting.</p></div></div><p>The simulation method is given as the type parameter <code>{NRPMD}</code> and the simulation constructor is given the atoms, model, number of beads, temperature and degrees of freedom.</p><pre><code class="language-julia hljs">sim = RingPolymerSimulation{NRPMD}(atom, DoubleWell(γ=0.1), 4; temperature=1/16)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">RingPolymerSimulation{NRPMD{Float64}}:

  Atoms{Float64}([:X], [0], [1.0])

  DoubleWell{Int64, Int64, Float64, Int64}
  mass: Int64 1
  ω: Int64 1
  γ: Float64 0.1
  Δ: Int64 1

  with 4 beads.</code></pre><p>Next, we can use this distribution as a starting point for the dynamics simulations. This will result in each trajectory starting from a random configuration in the distribution. For NRPMD, the electronic variables are sampled from a Gaussian, independent of the initial electronic state. The electronic state is introduced in the correlation function expression when correlating the initial and final populations.</p><p>The quantities output by the ensemble simulation are specified by the <code>output</code> and the <code>reduction</code>. The <code>output</code> follows the <code>DifferentialEquations</code> format where we provide a function that determines the output of each trajectory. The <code>reduction</code> can be one of <code>:mean</code>, <code>:append</code>, or <code>:sum</code>, which will determine how the data from each trajectory is combined.</p><div class="admonition is-info"><header class="admonition-header">Ensemble simulations</header><div class="admonition-body"><p>Further details on ensemble simulations are available <a href="../../ensemble_simulations.html#ensembles">here</a>.</p></div></div><pre><code class="language-julia hljs">output = TimeCorrelationFunctions.PopulationCorrelationFunction(sim, Diabatic())</code></pre><p>Finally, we can combine the parameters and run the simulation. The resulting plot shows the time dependent population difference and closely matches the figure from the paper we were attempting to reproduce. Nice!</p><pre><code class="language-julia hljs">ensemble = run_dynamics(sim, (0.0, 30.0), distribution;
    trajectories=100, output, reduction=MeanReduction(), dt=0.1)

plot(0:0.1:30, [p[1,1]-p[2,1] for p in ensemble[:PopulationCorrelationFunction]])
xlabel!(&quot;Time&quot;)
ylabel!(&quot;Population difference&quot;)</code></pre><img src="nrpmd-d9ddb863.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="mdef.html">« Molecular dynamics with electronic friction (MDEF)</a><a class="docs-footer-nextpage" href="rpmd.html">Ring polymer molecular dynamics (RPMD) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Tuesday 16 July 2024 10:49">Tuesday 16 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
