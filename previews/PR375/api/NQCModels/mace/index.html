<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>MACEModels.jl · NQCDynamics.jl</title><meta name="title" content="MACEModels.jl · NQCDynamics.jl"/><meta property="og:title" content="MACEModels.jl · NQCDynamics.jl"/><meta property="twitter:title" content="MACEModels.jl · NQCDynamics.jl"/><meta name="description" content="Documentation for NQCDynamics.jl."/><meta property="og:description" content="Documentation for NQCDynamics.jl."/><meta property="twitter:description" content="Documentation for NQCDynamics.jl."/><meta property="og:url" content="https://nqcd.github.io/NQCDynamics.jl/stable/api/NQCModels/mace/"/><meta property="twitter:url" content="https://nqcd.github.io/NQCDynamics.jl/stable/api/NQCModels/mace/"/><link rel="canonical" href="https://nqcd.github.io/NQCDynamics.jl/stable/api/NQCModels/mace/"/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="NQCDynamics.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">NQCDynamics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Introduction</a></li><li><a class="tocitem" href="../../../getting_started/">Getting started</a></li><li><a class="tocitem" href="../../../atoms/">Atoms</a></li><li><a class="tocitem" href="../../../ensemble_simulations/">Ensemble simulations</a></li><li><a class="tocitem" href="../../../saving_loading/">Saving and loading</a></li><li><span class="tocitem">NQCModels.jl</span><ul><li><a class="tocitem" href="../../../NQCModels/overview/">NQCModels.jl</a></li><li><a class="tocitem" href="../../../NQCModels/combining_models/">Composing multiple models</a></li><li><a class="tocitem" href="../../../NQCModels/combining_models/">Composing multiple models</a></li><li><a class="tocitem" href="../../../NQCModels/analyticmodels/">Analytic model library</a></li><li><a class="tocitem" href="../../../NQCModels/machinelearningmodels/">Machine learning interatomic potentials</a></li><li><a class="tocitem" href="../../../NQCModels/fullsizemodels/">Full dimensional model library</a></li><li><a class="tocitem" href="../../../NQCModels/frictionmodels/">Electronic friction models</a></li></ul></li><li><span class="tocitem">NQCDistributions.jl</span><ul><li><a class="tocitem" href="../../../NQCDistributions/overview/">NQCDistributions.jl</a></li></ul></li><li><span class="tocitem">Initial conditions</span><ul><li><a class="tocitem" href="../../../initialconditions/ebk/">Semiclassical EBK quantisation</a></li><li><a class="tocitem" href="../../../initialconditions/hamiltonian/">Thermal Hamiltonian Monte Carlo</a></li><li><a class="tocitem" href="../../../initialconditions/langevin/">Thermal Langevin dynamics</a></li><li><a class="tocitem" href="../../../initialconditions/metropolishastings/">Thermal Metropolis-Hastings Monte Carlo</a></li></ul></li><li><span class="tocitem">Dynamics simulations</span><ul><li><a class="tocitem" href="../../../dynamicssimulations/dynamicssimulations/">Introduction</a></li><li><a class="tocitem" href="../../../dynamicssimulations/dynamicsmethods/classical/">Classical molecular dynamics</a></li><li><a class="tocitem" href="../../../dynamicssimulations/dynamicsmethods/ehrenfest/">Ehrenfest molecular dynamics</a></li><li><a class="tocitem" href="../../../dynamicssimulations/dynamicsmethods/fssh/">Fewest-switches surface hopping (FSSH)</a></li><li><a class="tocitem" href="../../../dynamicssimulations/dynamicsmethods/langevin/">Classical Langevin dynamics</a></li><li><a class="tocitem" href="../../../dynamicssimulations/dynamicsmethods/mdef/">Molecular dynamics with electronic friction (MDEF)</a></li><li><a class="tocitem" href="../../../dynamicssimulations/dynamicsmethods/nrpmd/">Nonadiabatic ring polymer molecular dynamics (NRPMD)</a></li><li><a class="tocitem" href="../../../dynamicssimulations/dynamicsmethods/rpmd/">Ring polymer molecular dynamics (RPMD)</a></li><li><a class="tocitem" href="../../../dynamicssimulations/dynamicsmethods/rpsh/">Ring polymer surface hopping (RPSH)</a></li></ul></li><li><span class="tocitem">Outputs and Analysis</span><ul><li><a class="tocitem" href="../../../output_and_analysis/intro/">Simulations outputs and analysis functions</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../../examples/mdef_multithermostat/">MDEF with the Two-temperature model and separate Electron and Phonon Thermostats</a></li><li><a class="tocitem" href="../../../examples/reactive_scattering/">Reactive scattering from a metal surface</a></li><li><a class="tocitem" href="../../../examples/spinboson/">Ohmic spin-boson nonequilibrium population dynamics</a></li><li><a class="tocitem" href="../../../examples/threestatemorse/">Time-dependent populations with the ThreeStateMorse model</a></li><li><a class="tocitem" href="../../../examples/tully_scattering/">Scattering probabilities for TullyModelTwo</a></li></ul></li><li><a class="tocitem" href="../../../integration_algorithms/">Integration algorithms</a></li><li><span class="tocitem">Developer documentation</span><ul><li><a class="tocitem" href="../../../devdocs/diffeq/">DifferentialEquations.jl integration</a></li><li><a class="tocitem" href="../../../devdocs/models/">Implementing a new model</a></li><li><a class="tocitem" href="../../../devdocs/new_methods/">Contributing a new method</a></li></ul></li><li><span class="tocitem">API</span><ul><li><input class="collapse-toggle" id="menuitem-14-1" type="checkbox"/><label class="tocitem" for="menuitem-14-1"><span class="docs-label">NQCBase</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../NQCBase/nqcbase/">NQCBase</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14-2" type="checkbox" checked/><label class="tocitem" for="menuitem-14-2"><span class="docs-label">NQCModels</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../FrictionProviders/">FrictionModels</a></li><li><a class="tocitem" href="../adiabaticmodels/">AdiabaticModels</a></li><li><a class="tocitem" href="../diabaticmodels/">DiabaticModels</a></li><li><a class="tocitem" href="../frictionmodels/">FrictionProviders.jl</a></li><li class="is-active"><a class="tocitem" href>MACEModels.jl</a></li><li><a class="tocitem" href="../nonadiabaticmodels/">NQCModels</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14-3" type="checkbox"/><label class="tocitem" for="menuitem-14-3"><span class="docs-label">NQCDistributions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../NQCDistributions/nqcdistributions/">NQCDistributions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14-4" type="checkbox"/><label class="tocitem" for="menuitem-14-4"><span class="docs-label">NQCDynamics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../NQCDynamics/analysis/">Analysis</a></li><li><a class="tocitem" href="../../NQCDynamics/calculators/">Calculators</a></li><li><a class="tocitem" href="../../NQCDynamics/dynamicsmethods/">DynamicsMethods</a></li><li><a class="tocitem" href="../../NQCDynamics/dynamicsoutputs/">DynamicsOutputs</a></li><li><a class="tocitem" href="../../NQCDynamics/dynamicsutils/">DynamicsUtils</a></li><li><a class="tocitem" href="../../NQCDynamics/ensembles/">Ensembles</a></li><li><a class="tocitem" href="../../NQCDynamics/estimators/">Estimators</a></li><li><a class="tocitem" href="../../NQCDynamics/initialconditions/">InitialConditions</a></li><li><a class="tocitem" href="../../NQCDynamics/nonadiabaticmoleculardynamics/">NQCDynamics</a></li><li><a class="tocitem" href="../../NQCDynamics/numericutils/">Numerical utilities</a></li><li><a class="tocitem" href="../../NQCDynamics/ringpolymers/">RingPolymers</a></li><li><a class="tocitem" href="../../NQCDynamics/structure/">Structure</a></li><li><a class="tocitem" href="../../NQCDynamics/timecorrelationfunctions/">TimeCorrelationFunctions</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API</a></li><li><a class="is-disabled">NQCModels</a></li><li class="is-active"><a href>MACEModels.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>MACEModels.jl</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/NQCD/NQCDynamics.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/NQCD/NQCDynamics.jl/blob/main/docs/src/api/NQCModels/mace.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="MACEModels.jl"><a class="docs-heading-anchor" href="#MACEModels.jl">MACEModels.jl</a><a id="MACEModels.jl-1"></a><a class="docs-heading-anchor-permalink" href="#MACEModels.jl" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.MACEModel" href="#MACEModels.MACEModel"><code>MACEModels.MACEModel</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>MACE interface with support for ensemble of models and batch size selection for potentially faster inference.</p><p>DOFs currently hardcoded at 3.</p><p><strong>Fields</strong></p><ul><li><code>model_paths::Vector{String}</code>: Model paths to load. If multiple paths are given, an ensemble of models is used and mean energies/forces used to propagate dynamics.</li><li><code>models::Vector</code>: Loaded models.</li><li><code>device::Vector{String}</code>: Device to use for inference. If a single device is given, all models will be loaded on that device. If multiple devices are given, each model will be loaded on the corresponding device. Default is <code>&quot;cpu&quot;</code>.</li><li><code>default_dtype::Type{T}</code>: Default data type for inference. Default is <code>Float32</code>.</li><li><code>batch_size::Union{Int,Nothing}</code>: Batch size for inference. Default is <code>1</code>.</li><li><code>cutoff_radius::T</code>: Cutoff radius for the models.</li><li><code>last_eval_cache::MACEPredictionCache</code>: Cache for the last evaluation.</li><li><code>z_table</code>: Table of atomic numbers.</li><li><code>atoms::Atoms</code>: Atoms object for the system.</li><li><code>cell::PeriodicCell</code>: Periodic cell for the system.</li><li><code>ndofs::Int</code>: Number of degrees of freedom in the system.</li><li><code>mobile_atoms::Vector{Int}</code>: Indices of mobile atoms in the system.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L52-L70">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.MACEModel-Tuple{Atoms, AbstractCell, Vector{String}}" href="#MACEModels.MACEModel-Tuple{Atoms, AbstractCell, Vector{String}}"><code>MACEModels.MACEModel</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MACEModel(
atoms::Atoms,
cell::AbstractCell,
model_paths::Vector{String};
device::Union{String,Vector{String}}=&quot;cpu&quot;,
default_dtype::Type=Float32,
batch_size::Int=1,
mobile_atoms::Vector{Int}=collect(1:length(atoms)),</code></pre><p>)     model<em>paths::Vector{String},     device::Union{String, Vector{String}}=&quot;cpu&quot;,     default</em>dtype::Type=Float64,     batch_size::Int=1,     atoms,     cell, )</p><p>Interface to MACE machine learning interatomic potentials with support for ensemble of models and batch size selection for potentially faster inference.</p><p><strong>Arguments</strong></p><ul><li><code>atoms</code>: Atoms object for the system. <code>predict!</code> can be called with a Vector of different Atoms objects to evaluate different structures.</li><li><code>cell</code>: Cell object for the system. <code>predict!</code> can be called with a Vector of different Cell objects to evaluate different structures.</li><li><code>model_paths::Vector{String}</code>: Model paths to load. If multiple paths are given, an ensemble of models is used and mean energies/forces used to propagate dynamics.</li><li><code>device::Union{String, Vector{String}}</code>: Device to use for inference. If a single device is given, all models will be loaded on that device. If multiple devices are given, each model will be loaded on the corresponding device. Default is <code>&quot;cpu&quot;</code>.</li><li><code>default_dtype::Type</code>: Default data type for PyTorch (usually Float32)</li><li><code>batch_size::Int</code>: Batch size for inference. Can be set to <code>nothing</code> to always adapt batch size to the number of structures provided. Ring-polymer methods benefit from this.</li><li><code>mobile_atoms::Vector{Int}</code>: Indices of mobile atoms in the system. Default is all atoms.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L92-L120">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.MACEPredictionCache" href="#MACEModels.MACEPredictionCache"><code>MACEModels.MACEPredictionCache</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Cache which stores the results of the last evaluation of the MACE model. This is used to speed up concurrent energy and force evaluations, as well as to give access to ensemble predictions.</p><p>Use e.g. <code>get_energy_mean(MACEModel.last_eval_cache)</code> to access results of the last prediction made by the model.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L38-L43">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.get_energy_ensemble-Tuple{MACEPredictionCache}" href="#MACEModels.get_energy_ensemble-Tuple{MACEPredictionCache}"><code>MACEModels.get_energy_ensemble</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_energy_ensemble(mace_cache::MACEPredictionCache)</code></pre><p>Returns the potential energy evaluated by each model in the ensemble in units of <strong>Hartree</strong>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L413-L417">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.get_energy_mean-Tuple{MACEPredictionCache}" href="#MACEModels.get_energy_mean-Tuple{MACEPredictionCache}"><code>MACEModels.get_energy_mean</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_energy_mean(mace_cache::MACEPredictionCache)</code></pre><p>Returns the mean potential energy of the structures stored in the evaluation cache.</p><p>Energy is returned in units of <strong>Hartree</strong>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L377-L383">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.get_energy_variance-Tuple{MACEPredictionCache}" href="#MACEModels.get_energy_variance-Tuple{MACEPredictionCache}"><code>MACEModels.get_energy_variance</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_energy_variance(mace_cache::MACEPredictionCache)</code></pre><p>Returns the variance of the potential energy in <strong>Hartree²</strong>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L396-L400">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.get_forces_ensemble-Tuple{MACEPredictionCache}" href="#MACEModels.get_forces_ensemble-Tuple{MACEPredictionCache}"><code>MACEModels.get_forces_ensemble</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_forces_ensemble(mace_cache::MACEPredictionCache)</code></pre><p>Returns the forces evaluated by each model in the ensemble in units of <strong>Hartree/Bohr</strong>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L466-L470">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.get_forces_mean-Tuple{MACEPredictionCache}" href="#MACEModels.get_forces_mean-Tuple{MACEPredictionCache}"><code>MACEModels.get_forces_mean</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_forces_mean(mace_cache::MACEPredictionCache)</code></pre><p>Returns the mean forces of the structures stored in the evaluation cache. Forces are returned in units of <strong>Hartree/Bohr</strong>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L430-L435">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.get_forces_variance-Tuple{MACEPredictionCache}" href="#MACEModels.get_forces_variance-Tuple{MACEPredictionCache}"><code>MACEModels.get_forces_variance</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_forces_variance(mace_cache::MACEPredictionCache)</code></pre><p>Returns the force variance of the structures stored in the evaluation cache. Forces are returned in units of <strong>Hartree²/Bohr²</strong>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L448-L453">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.mace_configuration_from_nqcd_configuration-Tuple{Atoms, AbstractCell, AbstractMatrix}" href="#MACEModels.mace_configuration_from_nqcd_configuration-Tuple{Atoms, AbstractCell, AbstractMatrix}"><code>MACEModels.mace_configuration_from_nqcd_configuration</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">mace_configuration_from_nqcd_configuration(
atoms::Atoms,
cell::Union{InfiniteCell, PeriodicCell},
R::AbstractMatrix,</code></pre><p>)</p><p>Converter into a single mace.data.utils.Configuration to make use of MACE&#39;s data loading.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L216-L224">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.predict!-Tuple{MACEModel, Union{Atoms, Vector{&lt;:Atoms}}, Vector{&lt;:AbstractMatrix}, Union{AbstractCell, Vector{&lt;:AbstractCell}}}" href="#MACEModels.predict!-Tuple{MACEModel, Union{Atoms, Vector{&lt;:Atoms}}, Vector{&lt;:AbstractMatrix}, Union{AbstractCell, Vector{&lt;:AbstractCell}}}"><code>MACEModels.predict!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">predict!(
mace_interface::MACEModel,
atoms::Union{Vector{&lt;:Atoms}, Atoms},
R::Vector{&lt;:AbstractMatrix},
cell::Union{Vector{&lt;:AbstractCell}, AbstractCell},
)</code></pre><p>Evaluate the MACE model on a set of structures if they haven&#39;t already been evaluated. The results are stored in <code>mace_interface.last_eval_cache</code>.</p><p>Use <code>methodswith(MACEPredictionCache)</code> to see what data is provided from the results</p><p><strong>Arguments</strong></p><p><code>mace_interface</code>: <code>MACEModel</code> to evaluate with.</p><p><code>atoms</code>: Atoms object for the structures passed for evaluation. Can be either a vector of different Atoms objects or a single Atoms object.</p><p><code>R</code>: Vector of structures to evaluate.</p><p><code>cell</code>: Cell object for the structures passed for evaluation. Can be either a vector of different Cell objects or a single Cell object.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L267-L290">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.predict-Tuple{MACEModel, Union{Atoms, Vector{&lt;:Atoms}}, Vector{&lt;:AbstractMatrix}, Union{AbstractCell, Vector{&lt;:AbstractCell}}}" href="#MACEModels.predict-Tuple{MACEModel, Union{Atoms, Vector{&lt;:Atoms}}, Vector{&lt;:AbstractMatrix}, Union{AbstractCell, Vector{&lt;:AbstractCell}}}"><code>MACEModels.predict</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">predict(
mace_interface::MACEModel,
atoms::Union{Vector{&lt;:Atoms}, Atoms},
R::Vector{&lt;:AbstractMatrix},
cell::Union{Vector{&lt;:AbstractCell}, AbstractCell},
)</code></pre><p>Evaluate the MACE model on a set of structures if they haven&#39;t already been evaluated. The results are returned as a <code>MACEPredictionCache</code>.</p><p>Use <code>methodswith(MACEPredictionCache)</code> to see what data can be provided from the results.</p><p><strong>Arguments</strong></p><p><code>mace_interface</code>: <code>MACEModel</code> to evaluate with.</p><p><code>atoms</code>: Atoms object for the structures passed for evaluation. Can be either a vector of different Atoms objects or a single Atoms object.</p><p><code>R</code>: Vector of structures to evaluate.</p><p><code>cell</code>: Cell object for the structures passed for evaluation. Can be either a vector of different Cell objects or a single Cell object.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L341-L364">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NQCModels.derivative!-Union{Tuple{T}, Tuple{MACEModel, Atoms, AbstractArray{T, 3}, Vector{&lt;:AbstractMatrix}, Union{InfiniteCell, PeriodicCell}}} where T" href="#NQCModels.derivative!-Union{Tuple{T}, Tuple{MACEModel, Atoms, AbstractArray{T, 3}, Vector{&lt;:AbstractMatrix}, Union{InfiniteCell, PeriodicCell}}} where T"><code>NQCModels.derivative!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">NQCModels.derivative(model::MACEModel, atoms::Atoms, R::AbstractArray{T,3}, cell::Union{InfiniteCell, PeriodicCell})</code></pre><p>This variant of <code>NQCModels.derivative</code> can make use of batch evaluation to speed up inference for multiple structures.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L546-L551">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NQCModels.derivative-Tuple{MACEModel, Atoms, Vector{&lt;:AbstractMatrix}, Union{InfiniteCell, PeriodicCell}}" href="#NQCModels.derivative-Tuple{MACEModel, Atoms, Vector{&lt;:AbstractMatrix}, Union{InfiniteCell, PeriodicCell}}"><code>NQCModels.derivative</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">NQCModels.derivative(model::MACEModel, atoms::Atoms, R::Vector{&lt;:AbstractMatrix}, cell::Union{InfiniteCell, PeriodicCell})</code></pre><p>This variant of <code>NQCModels.derivative</code> can make use of batch evaluation to speed up inference for multiple structures.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L528-L533">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NQCModels.potential-Tuple{MACEModel, Atoms, Vector{&lt;:AbstractMatrix}, AbstractCell}" href="#NQCModels.potential-Tuple{MACEModel, Atoms, Vector{&lt;:AbstractMatrix}, AbstractCell}"><code>NQCModels.potential</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">NQCModels.potential(model::MACEModel, atoms::Atoms, R::Vector{&lt;:AbstractMatrix}, cell::AbstractCell)</code></pre><p>This variant of <code>NQCModels.potential</code> can make use of batch evaluation to speed up inference for multiple structures.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModels.jl#L515-L520">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.Ensemble.CustomSplitDistributed" href="#MACEModels.Ensemble.CustomSplitDistributed"><code>MACEModels.Ensemble.CustomSplitDistributed</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Ensemble algorithm which enforces the split between dynamics and inference workers provided.</p><p><strong>Even when specifying this EnsembleAlgorithm, you still need to manually dispatch</strong></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModelsMPI.jl#L20-L25">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.Ensemble.EnergyForcesCache" href="#MACEModels.Ensemble.EnergyForcesCache"><code>MACEModels.Ensemble.EnergyForcesCache</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Containers for energy and forces, to be used in the RemoteModel.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModelsMPI.jl#L59-L61">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.Ensemble.MultiProcessConfig-Tuple{Any, Any, Function, Any}" href="#MACEModels.Ensemble.MultiProcessConfig-Tuple{Any, Any, Function, Any}"><code>MACEModels.Ensemble.MultiProcessConfig</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MultiProcessConfig(runners, evaluators, model_load_function::Function, positions_prototype; model_listener::Function=batch_evaluation_loop)</code></pre><p>Configuration for distributed execution dynamics propagation and model evaluation.</p><p><strong>Arguments</strong></p><ul><li><code>runners::Vector{Int}</code>: Process IDs of the NQCDynamics workers.</li><li><code>evaluators::Vector{Int}</code>: Process IDs of the model evaluators.</li><li><code>model_load_function::Function</code>: Function <code>()-&gt;x&lt;:Model</code> that can load the model to be evaluated on any process. (i.e. not specific to a process)</li><li><code>model_listener::Function</code>: Function that listens for structures on the input channels and outputs the results on the output channels. Default is <code>batch_evaluation_loop</code>. <code>(model, input_channels, output_channels)-&gt;()</code></li><li><code>positions_prototype</code>: Sample atomic positions to determine system size.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModelsMPI.jl#L31-L42">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.Ensemble.RemoteModel-Tuple{MACEModels.Ensemble.MultiProcessConfig, Any}" href="#MACEModels.Ensemble.RemoteModel-Tuple{MACEModels.Ensemble.MultiProcessConfig, Any}"><code>MACEModels.Ensemble.RemoteModel</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">RemoteModel(config::MultiProcessConfig, structure_prototype)</code></pre><p>Creates a RemoteModel that can be used to evaluate structures on a remote process.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModelsMPI.jl#L142-L146">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MACEModels.Ensemble.batch_evaluation_loop-Tuple{Function, Vector{Distributed.RemoteChannel}, Vector{Distributed.RemoteChannel}}" href="#MACEModels.Ensemble.batch_evaluation_loop-Tuple{Function, Vector{Distributed.RemoteChannel}, Vector{Distributed.RemoteChannel}}"><code>MACEModels.Ensemble.batch_evaluation_loop</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">batch_evaluation_loop(model&lt;:Model, input_channels::Vector{RemoteChannel}, output_channels::Vector{RemoteChannel}; user_model_function::Function=mace_batch_predict, max_delay = 1000)</code></pre><p><strong>This doesn&#39;t know how to use your model most efficiently, it only handles I/O between processes!</strong></p><p>To use this communication wrapper, you need to define a function that evaluates your model and returns a tuple of energies and forces, as shown in the example:</p><pre><code class="nohighlight hljs">function user_model_function(model&lt;:Model, structures::AbstractVector{AbstractMatrix{Number}})
    MACEModels.predict!(model, model.atoms, structures, model.cell)
    energies = MACEModels.get_energy_mean(model.last_eval_cache) # This is a Vector{Number} type
    forces = MACEModels.get_forces_mean(model.last_eval_cache) # This is a Vector{Matrix{Number}} type
    return (energies, forces)
end</code></pre><p>It polls the input channels for new structures, and when it finds them, it evaluates them using the user-defined model function. The results are then put back into the correct output channels.</p><p><strong>Arguments</strong></p><ul><li><code>model::Model</code>: The model that will be used for evaluation.</li><li><code>input_channels::Vector{RemoteChannel}</code>: The input channels that will be used to receive structures.</li><li><code>output_channels::Vector{RemoteChannel}</code>: The output channels that will be used to send the results.</li><li><code>user_model_function::Function</code>: The user-defined function that will be used to evaluate the model.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/MACEModels.jl/blob/v1.1.0/src/MACEModelsMPI.jl#L84-L109">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../frictionmodels/">« FrictionProviders.jl</a><a class="docs-footer-nextpage" href="../nonadiabaticmodels/">NQCModels »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Friday 7 March 2025 00:49">Friday 7 March 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
